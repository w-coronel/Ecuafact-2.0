function roundf(n,t){var r=parseFloat(n),i="0.00";return isNaN(r)||(r=Math.round(r*Math.pow(10,t))/Math.pow(10,t),i=String(r),i+=(-1==i.indexOf(".")?".":"")+String(Math.pow(10,t)).substr(1),i=i.substr(0,i.indexOf(".")+t+1)),i}function strPad(n,t,i){return i=i||"0",n+="",n.length>=t?n:new Array(t-n.length+1).join(i)+n}function validarIdentificacion2(n,t){if(error=!1,validar=!1,"05"==t?(validar=!0,"10"!=n.length&&(error=!0)):"04"==t?(validar=!0,13!=n.length&&(error=!0)):"00"==t&&(validar=!0,13!=n.length&&10!=n.length&&(error=!0)),validar&&!error){if(13==n.length)return!1;for(array=n.split(""),num=array.length,total=0,digito=1*array[9],i=0;i<9;i++)mult=0,i%2!=0?total+=1*array[i]:(mult=2*array[i],total+=mult>9?mult-9:mult);decena=total/10;decena=Math.floor(decena);decena=10*(decena+1);final=decena-total;(10==final&&0!=digito||final!=digito)&&(error=!0)}return error}function validarIdentificacion(n,t){var l;if(error=!1,validar=!1,5==t||4==t){var r=n,o=0,u=0,s=!1,h=!1,c=!1,f=11,e=1;for(i=0;i<r.length&&1==e;i++)l=parseInt(r.charAt(i)),isNaN(l)&&(e=0);if(0==e||10!=r.length&&"05"==t||13!=r.length&&"04"==t)return!0;if("0960571719001"==r||"0960056208001"==r||"0960841922001"==r||"0962285938001"==r||"3050136161001"==r||"0962334777001"==r||"0960723955001"==r||"096"==r.substr(0,3))return!1;if((provincia=r.substr(0,2),provincia<1||provincia>24)||(d1=r.substr(0,1),d2=r.substr(1,1),d3=r.substr(2,1),d4=r.substr(3,1),d5=r.substr(4,1),d6=r.substr(5,1),d7=r.substr(6,1),d8=r.substr(7,1),d9=r.substr(8,1),d10=r.substr(9,1),7==d3||8==d3))return!0;if(d3<6?(c=!0,p1=2*d1,p1>=10&&(p1-=9),p2=1*d2,p2>=10&&(p2-=9),p3=2*d3,p3>=10&&(p3-=9),p4=1*d4,p4>=10&&(p4-=9),p5=2*d5,p5>=10&&(p5-=9),p6=1*d6,p6>=10&&(p6-=9),p7=2*d7,p7>=10&&(p7-=9),p8=1*d8,p8>=10&&(p8-=9),p9=2*d9,p9>=10&&(p9-=9),f=10):6==d3?(h=!0,p1=3*d1,p2=2*d2,p3=7*d3,p4=6*d4,p5=5*d5,p6=4*d6,p7=3*d7,p8=2*d8,p9=0):9==d3&&(s=!0,p1=4*d1,p2=3*d2,p3=2*d3,p4=7*d4,p5=6*d5,p6=5*d6,p7=4*d7,p8=3*d8,p9=2*d9),o=p1+p2+p3+p4+p5+p6+p7+p8+p9,u=o%f,digitoVerificador=0==u?0:f-u,1==h){if(digitoVerificador!=d9||"0001"!=r.substr(9,4))return!0}else if(1==s){if(digitoVerificador!=d10||"001"!=r.substr(10,3))return!0}else if(1==c&&(digitoVerificador!=d10||r.length>10&&"001"!=r.substr(10,3)))return!0}return!1}function esConsumidorFinal(){return"07"==$("select[name='cliente_tipo_identificacion']").val()}function generarJsonCliente(){var n={};return n.razon_social=$('input[name="cliente_razon_social"]').val(),n.identificacion=$('input[name="cliente_identificacion"]').val(),n.tipo_identificacion=$('select[name="cliente_tipo_identificacion"]').val(),n.direccion=$('input[name="cliente_direccion"]').val(),n.email=$('input[name="cliente_email"]').val(),n.telefono=$('input[name="cliente_telefono"]').val(),n.fecha_inicio=$('input[name="start"]').val(),n.fecha_fin=$('input[name="end"]').val(),n.repeticiones=$('input[name="repeticiones"]').val(),n.periocidad=$('select[name="opciones_factura_periocidad"]').val(),n.descripcion=$('textarea[name="descripcion"]').val(),n}function sendXml(n,t,i){$.ajax("/getPreviewDocument",{data:{xml:n,tipo_documento:t,establecimiento_id:i},dataType:"json",type:"POST",async:!1,success:function(n){document.getElementById("divPreviewView").innerHTML=n.xml},error:function(){}})}function sendXmlPreFactura(n,t){$.ajax("/getPreviewDocumentPreFactura",{data:{xml:n,establecimiento_id:t},dataType:"json",type:"POST",async:!1,success:function(n){document.getElementById("divPreviewView").innerHTML=n.xml},error:function(){}})}function resizeIframe(n){document.getElementById(n).height="500px"}function onlyNumber(n){var t=n.which?n.which:n.keyCode;return!(t>31&&(t<48||t>57))}function onlyNumberAndMiddleScript(n){var t=n.which?n.which:n.keyCode;return!(t>31&&(t<48||t>57))||45==t}function validarEmailCliente(n){var r=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,u=n.split(","),t=!1,i="";return $.each(u,function(n,u){i=u.split(";");$.each(i,function(n,i){r.test(i)||(t=!0,$(".bootstrap-tagsinput").addClass("errorTagsInput"))})}),t}function getIceXml(){var n=[];return $(".table-items tbody tr").each(function(){var t=[];if(t[0]=$(this).find('input[name="documento_ice_base_imponible[]"]').val(),t[1]=$(this).find('input[name="documento_ice_codigo[]"]').val(),t[2]=$(this).find('input[name="documento_ice_porcentaje[]"]').val(),t[3]=$(this).find('input[name="documento_ice_valor[]"]').val(),parseInt(t[1])>0){for(is_new=!0,i=0;i<n.length;i++)n[i][1]==t[1]&&(n[i][0]=parseFloat(n[i][0])+parseFloat(t[0]),n[i][3]=parseFloat(n[i][3])+parseFloat(t[3]),is_new=!1);1==is_new&&n.push(t)}}),n}function calcularICE(){valor=$("input[name='documento_ice_porcentaje_campo']").val()*$("input[name='documento_ice_base_imponible_campo']").val()/100;$("input[name='documento_ice_valor_campo']").val(roundf(valor,2).toString())}function calcularICEReembolso(){valor=$("input[name='documento_ice_porcentaje_campo_reembolso']").val()*$("input[name='documento_ice_base_imponible_campo_reembolso']").val()/100;$("input[name='documento_ice_valor_campo_reembolso']").val(roundf(valor,2).toString())}function calcularIRBPNR(){valor=$("input[name='documento_irbpnr_porcentaje_campo']").val()*$("input[name='documento_irbpnr_base_imponible_campo']").val();$("input[name='documento_irbpnr_valor_campo']").val(roundf(valor,2).toString())}function calcularIRBPNRReembolso(){valor=$("input[name='documento_irbpnr_porcentaje_campo_reembolso']").val()*$("input[name='documento_irbpnr_base_imponible_campo_reembolso']").val();$("input[name='documento_irbpnr_valor_campo_reembolso']").val(roundf(valor,2).toString())}function calcularFactura(n){var ut=$('select[name="tipoFactura"]').val(),ft=$('input[name="descuento-porcentaje"]').val(),l=0,r=0,a=0,u=0,f=0,v=0,i=0,e=0,y=0,o=0,s=0,t=0,b=0,k=0,d=0,g=0,h=0,p=0,c=0,w,nt,tt,it,rt;$(".table-items tbody tr").each(function(){$(this).children("td").each(function(n){switch(n){case 2:l=$(this).find('input[name="item_cantidad[]"]').val();$(this).find('input[name="item_cantidad[]"]').val(roundf(l,6));break;case 3:a=$(this).find('input[name="item_precio_unitario[]"]').val();$(this).find('input[name="item_precio_unitario[]"]').val(roundf(a,6));break;case 4:1==ft?(porcentajeDescuento=$(this).find('input[name="item_descuento[]"]').val(),r=parseFloat(a)*porcentajeDescuento*l/100,$(this).find('input[name="item_descuento[]"]').text(roundf(porcentajeDescuento,2)+"asdasdasdas")):(r=$(this).find('input[name="item_descuento[]"]').val(),$(this).find('input[name="item_descuento[]"]').val(roundf(r,2)));break;case 5:u=roundf(parseFloat(a)*parseFloat(l)-r,2);$(this).find('input[name="item_precio_total[]"]').val(u);break;case 6:f=$(this).find('select[name="item_iva[]"]').val();break;case 7:t=$(this).find('input[name="documento_ice_valor[]"]').val();p=$(this).find('input[name="documento_irbpnr_valor[]"]').val()}});2==f||3==f?(i=parseFloat(i)+parseFloat(u),t>0&&(i+=parseFloat(t),b+=parseFloat(t))):0==f?(e=parseFloat(e)+parseFloat(u),t>0&&(e+=parseFloat(t),k+=parseFloat(t))):6==f?(s=parseFloat(s)+parseFloat(u),t>0&&(s+=parseFloat(t),d+=parseFloat(t))):7==f&&(o=parseFloat(o)+parseFloat(u),t>0&&(o+=parseFloat(t),g+=parseFloat(t)));t>0&&(h+=parseFloat(t));p>0&&(c+=parseFloat(p));"0"!=r&&(y=parseFloat(y)+parseFloat(r))});v+=i*(n/100);$("input[name='documento_subtotal_12']").val(roundf(i,2).toString());$("input[name='documento_subtotal_0']").val(roundf(e,2).toString());$("input[name='documento_subtotal_exento_iva']").val(roundf(o,2).toString());$("input[name='documento_subtotal_no_iva']").val(roundf(s,2).toString());$("input[name='documento_ice']").val(roundf(h,2).toString());$("input[name='documento_irbpnr']").val(roundf(c,2).toString());subtotal=i+e+o+s-b-k-g-d;$("input[name='documento_subtotal_sin_impuestos']").val(roundf(subtotal,2).toString());isPropinaChecked=$('input[name="documento_propina_check"]').is(":checked");isPropinaChecked?$("input[name='documento_propina']").val(roundf(subtotal/10,2)):$("input[name='documento_propina']").val("0.00");propina=parseFloat($("input[name='documento_propina']").val());isLeySolidariaChecked=$('input[name="documento_ley_solidaria_check"]').is(":checked");isLeySolidariaChecked?$("input[name='documento_ley_solidaria']").val(roundf(i/50,2)):$("input[name='documento_ley_solidaria']").val("0.00");ley_solidaria=parseFloat($("input[name='documento_ley_solidaria']").val());$("input[name='documento_total_descuento']").val(roundf(y,2).toString());$("input[name='documento_iva']").val(roundf(v.toString(),2));isNaN(h)&&(h=0);isNaN(c)&&(c=0);w=0;($(".table-rubros-terceros tbody tr").each(function(){var t=$(this).find('input[name="campo_rubros_terceros[]"]').val(),n=$(this).find('input[name="total_rubros_terceros[]"]').val();$(this).find('input[name="total_rubros_terceros[]"]').val(roundf(n,2));""!=t&&""!=n&&(w+=parseFloat($(this).find('input[name="total_rubros_terceros[]"]').val()))}),valor_total=subtotal+v+propina+h+c+w-ley_solidaria,2==ut)&&($("input[name='fleteInternacional']").val(roundf($("input[name='fleteInternacional']").val(),2)),nt=parseFloat($("input[name='fleteInternacional']").val())>=0?parseFloat($("input[name='fleteInternacional']").val()):0,$("input[name='seguroInternacional']").val(roundf($("input[name='seguroInternacional']").val(),2)),tt=parseFloat($("input[name='seguroInternacional']").val())>=0?parseFloat($("input[name='seguroInternacional']").val()):0,$("input[name='gastosAduaneros']").val(roundf($("input[name='gastosAduaneros']").val(),2)),it=parseFloat($("input[name='gastosAduaneros']").val())>=0?parseFloat($("input[name='gastosAduaneros']").val()):0,$("input[name='gastoTrasporte']").val(roundf($("input[name='gastoTrasporte']").val(),2)),rt=parseFloat($("input[name='gastoTrasporte']").val())>=0?parseFloat($("input[name='gastoTrasporte']").val()):0,valor_total+=nt+tt+it+rt);$("input[name='documento_valor_total']").val(roundf(valor_total,2).toString());$('input[name="documento_credito_check"]').is(":checked")?1==$('input[name="total_forma_pago_credito[]"]').length&&$('input[name="total_forma_pago_credito[]"]').val(roundf(valor_total,2)):1==$('input[name="total_forma_pago[]"]').length&&$('input[name="total_forma_pago[]"]').val(roundf(valor_total,2))}function limpiarRideFactura(){$(".ride-clean").html("");$(".ride .ride-productos > tbody").html("");$(".ride .ride-infoAdicional > tbody").html("");$(".ride .ride-forma-pago > tbody").html("");$(".ride .ride-impuesto0").html("0.00");$(".ride .ride-impuesto12").html("0.00");$(".ride .ride-impuesto-no-iva").html("0.00");$(".ride .ride-impuesto-exento-iva").html("0.00")}function SoloComaPuntoyNumeros(n){var t=n.keyCode;return(!n.shiftKey||188!=t&&190!=t&&110!=t)&&!(!SoloNumeros(n)&&188!=t&&190!=t&&110!=t)}function SoloNumeros(n){var t=n.keyCode;return!(n.shiftKey&&t>=48&&t<=57)&&(t>=48&&t<=57||t>=35&&t<=40||t>=96&&t<=105||8==t||9==t||45==t||46==t)}